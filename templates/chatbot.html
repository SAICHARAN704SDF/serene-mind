{% extends "base.html" %}

{% block title %}AI Chatbot - Serenemind{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-display font-bold text-white text-center mb-8 animate-fade-in">Chat with Sarah</h1>

    <div class="glass-effect rounded-2xl p-6">
        <div id="chat-messages" class="bg-black/20 p-4 rounded-xl mb-4 h-96 overflow-y-auto space-y-4">
            {% for message in messages %}
            <div class="flex {% if message.sender == 'user' %}justify-end{% else %}justify-start{% endif %}">
                <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-lg {% if message.sender == 'user' %}bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-br-md{% else %}bg-white text-gray-800 rounded-bl-md{% endif %}">
                    <p class="text-sm break-words">{{ message.text }}</p>
                </div>
            </div>
            {% endfor %}
        </div>

        <form id="chat-form" class="flex gap-4">
            <input type="text" id="message-input" name="message" placeholder="Share what's on your mind..." class="flex-grow p-4 rounded-full border-2 border-cyan-300 bg-white/90 text-gray-800 focus:outline-none focus:ring-4 focus:ring-cyan-300 transition-all duration-300 text-lg" required>
            <button type="submit" class="px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold rounded-full hover:from-cyan-400 hover:to-blue-400 transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-cyan-300 text-lg shadow-lg">
                Send âœ¨
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#chat-form').on('submit', function(e) {
        e.preventDefault();
        const message = $('#message-input').val();
        if (!message.trim()) return;

        // Add user message
        $('#chat-messages').append(`
            <div class="flex justify-end animate-fade-in-fast">
                <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-lg bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-br-md">
                    <p class="text-sm break-words">${message}</p>
                </div>
            </div>
        `);

        $('#message-input').val('');
        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);

        // Show typing indicator
        $('#chat-messages').append(`
            <div class="flex justify-start animate-fade-in-fast" id="typing">
                <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-lg bg-white text-gray-800 rounded-bl-md">
                    <div class="flex items-center space-x-2">
                        <span class="text-sm">Sarah is typing</span>
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-cyan-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-cyan-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-cyan-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>
        `);
        $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);

        // Send to server
        $.post('/send_message', { message: message }, function(data) {
            $('#typing').remove();
            $('#chat-messages').append(`
                <div class="flex justify-start animate-fade-in-fast">
                    <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-lg bg-white text-gray-800 rounded-bl-md">
                        <p class="text-sm break-words">${data.response}</p>
                    </div>
                </div>
            `);
            $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
        });
    });
});
</script>
{% endblock %}